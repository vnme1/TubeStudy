<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TubeStudy - í•™ìŠµ ì§„ë„ ê´€ë¦¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap");

      body {
        font-family: "Roboto", sans-serif;
        background-color: #0f0f0f; /* YouTube Dark Background */
        color: #f1f1f1;
      }

      /* ì»¤ìŠ¤í…€ ìŠ¤í¬ë¡¤ë°” */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f0f0f;
      }
      ::-webkit-scrollbar-thumb {
        background: #3f3f3f;
        border-radius: 4px;
      }

      /* ìœ íŠœë¸Œ ìŠ¤íƒ€ì¼ ì§„í–‰ë°” */
      .progress-bar-bg {
        background-color: #3f3f3f;
      }
      .progress-bar-fill {
        background-color: #cc0000;
      } /* YouTube Red */

      .thumbnail-card {
        aspect-ratio: 16/9;
      }
    </style>
  </head>
  <body class="h-screen flex overflow-hidden">
    <aside
      class="w-20 flex flex-col items-center py-6 bg-[#0f0f0f] border-r border-[#272727]"
    >
      <div class="mb-10 text-red-600 text-2xl">
        <i class="fab fa-youtube"></i>
      </div>

      <nav class="space-y-8 flex flex-col items-center w-full">
        <button class="text-white text-xl relative group">
          <i class="fas fa-home"></i>
          <span
            class="absolute left-10 bg-gray-800 px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-50"
            >ëŒ€ì‹œë³´ë“œ</span
          >
        </button>
        <button
          class="text-white hover:text-red-500 transition text-xl relative group"
        >
          <i class="fas fa-chart-pie"></i>
          <span
            class="absolute left-10 bg-gray-800 px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-50"
            >í†µê³„</span
          >
        </button>
        <button
          class="text-white hover:text-red-500 transition text-xl relative group"
        >
          <i class="fas fa-list"></i>
          <span
            class="absolute left-10 bg-gray-800 px-2 py-1 text-xs rounded opacity-0 group-hover:opacity-100 transition whitespace-nowrap z-50"
            >ì¬ìƒëª©ë¡</span
          >
        </button>
      </nav>

      <div class="mt-auto">
        <div
          class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs font-bold"
        >
          U
        </div>
      </div>
    </aside>

    <main class="flex-1 flex flex-col overflow-hidden">
      <header
        class="h-16 flex items-center justify-between px-8 border-b border-[#272727]"
      >
        <h1 class="text-lg font-bold tracking-tight">My Learning Space</h1>
        <div class="flex items-center gap-4">
          <!-- ìŠ¤íŠ¸ë¦­ ë°°ì§€ -->
          <a 
            href="settings.html"
            class="flex items-center gap-2 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700 px-3 py-1.5 rounded-full border border-red-500 transition cursor-pointer"
          >
            <span class="text-sm font-bold text-white">ğŸ”¥</span>
            <span class="text-xs font-bold text-white" id="streak-badge">0 Day</span>
          </a>

          <div
            class="flex items-center gap-2 bg-[#272727] px-3 py-1.5 rounded-full border border-[#3f3f3f]"
          >
            <span class="relative flex h-2 w-2">
              <span
                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"
              ></span>
              <span
                class="relative inline-flex rounded-full h-2 w-2 bg-red-500"
              ></span>
            </span>
            <span class="text-xs font-medium text-gray-300"
              >Extension Connected</span
            >
          </div>
          
          <a href="settings.html" class="text-gray-400 hover:text-white transition">
            <i class="fas fa-cog"></i>
          </a>
        </div>
      </header>

      <div class="flex-1 overflow-y-auto p-8">
        <section class="mb-10">
          <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
            <i class="fas fa-history text-red-500"></i> Continue Watching
          </h2>

          <div
            id="continue-card"
            class="bg-[#1f1f1f] rounded-xl p-6 flex gap-6 border border-[#272727] hover:border-[#3f3f3f] transition group cursor-pointer"
          >
            <a
              id="continue-link"
              href="#"
              class="w-80 thumbnail-card bg-black rounded-lg relative overflow-hidden flex-shrink-0"
            >
              <img
                id="thumbnail-img"
                src="https://img.youtube.com/vi/tEii94C8hYk/maxresdefault.jpg"
                class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition"
                alt="Thumbnail"
              />
              <div
                id="video-duration"
                class="absolute bottom-2 right-2 bg-black/80 text-white text-xs px-1 rounded"
              >
                24:15
              </div>
              <div
                class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition"
              >
                <div
                  class="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center text-white shadow-lg"
                >
                  <i class="fas fa-play ml-1"></i>
                </div>
              </div>
              <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-600">
                <div
                  id="progress-bar-fill"
                  class="h-full bg-red-600 w-[65%]"
                ></div>
              </div>
            </a>

            <div class="flex-1 flex flex-col justify-center">
              <div id="channel-name" class="text-sm text-gray-400 mb-1">
                Spring Boot 3.0 Master Class
              </div>
              <h3
                id="video-title"
                class="text-2xl font-bold mb-2 text-white group-hover:text-red-500 transition"
              >
                24. REST API ì„¤ê³„ ë° êµ¬í˜„í•˜ê¸°
              </h3>
              <p class="text-gray-500 text-sm mb-6 line-clamp-2">
                ì´ë²ˆ ì‹œê°„ì—ëŠ” Spring Web MVCë¥¼ ì‚¬ìš©í•˜ì—¬ RESTful APIë¥¼ ì„¤ê³„í•˜ëŠ”
                ì›ì¹™ê³¼ ì‹¤ì œ ì½”ë“œ êµ¬í˜„ ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë´…ë‹ˆë‹¤. @RestController
                ì–´ë…¸í…Œì´ì…˜ê³¼...
              </p>

              <div class="flex items-center gap-6">
                <div>
                  <div class="text-xs text-gray-400 mb-1">Current Progress</div>
                  <div class="text-lg font-bold">
                    <span id="progress-percentage">65</span>%
                    <span class="text-sm text-gray-500 font-normal"
                      >/ 100%</span
                    >
                  </div>
                </div>
                <div>
                  <div class="text-xs text-gray-400 mb-1">Remaining</div>
                  <div id="remaining-time" class="text-lg font-bold">08:15</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div id="courses-section" class="lg:col-span-2">
            <h2 class="text-xl font-bold mb-4">My Courses</h2>
            <div id="course-list-container" class="space-y-4">
              <p class="text-gray-500 p-4">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
          </div>

          <div id="stats-section" class="lg:col-span-1 space-y-6">
            <div class="bg-[#1f1f1f] p-6 rounded-xl border border-[#272727]">
              <h3 class="text-gray-400 text-xs font-bold uppercase mb-4 tracking-wider">
                ğŸ“Š ê¸°ê°„ ì„ íƒ
              </h3>
              <div class="grid grid-cols-2 gap-2 mb-6">
                <button
                  data-period="today"
                  class="period-button py-2 px-3 text-xs font-semibold rounded-lg bg-[#272727] text-gray-300 hover:bg-red-600 hover:text-white transition border border-transparent"
                >
                  ğŸ“… ì˜¤ëŠ˜
                </button>
                <button
                  data-period="week"
                  class="period-button py-2 px-3 text-xs font-semibold rounded-lg bg-[#272727] text-gray-300 hover:bg-red-600 hover:text-white transition border border-transparent"
                >
                  ğŸ“† ì´ë²ˆ ì£¼
                </button>
                <button
                  data-period="month"
                  class="period-button py-2 px-3 text-xs font-semibold rounded-lg bg-[#272727] text-gray-300 hover:bg-red-600 hover:text-white transition border border-transparent"
                >
                  ğŸ“† ì´ë²ˆ ë‹¬
                </button>
                <button
                  data-period="all"
                  class="period-button py-2 px-3 text-xs font-semibold rounded-lg bg-[#272727] text-gray-300 hover:bg-red-600 hover:text-white transition border border-transparent"
                >
                  âˆ ì „ì²´ ëˆ„ì 
                </button>
              </div>

              <h3 class="text-gray-400 text-xs font-bold uppercase mb-4 tracking-wider">
                â±ï¸ í•™ìŠµ ì‹œê°„
              </h3>
              <div class="flex items-end gap-2 mb-2">
                <span
                  id="total-study-time"
                  class="text-3xl font-black text-white"
                  >00ì‹œê°„ 00ë¶„</span
                >
              </div>
              <div
                class="w-full bg-gray-700 h-2 rounded-full mt-4 overflow-hidden"
              >
                <div
                  id="week-goal-bar"
                  class="h-full bg-gradient-to-r from-red-600 to-orange-500 w-[0%] transition-all duration-300"
                ></div>
              </div>
              <p class="text-xs text-gray-500 mt-2 text-right">
                ì£¼ê°„ ëª©í‘œì˜ <span id="week-goal-percentage">0</span>% ë‹¬ì„±
              </p>
            </div>

            <div class="bg-[#1f1f1f] p-6 rounded-xl border border-[#272727]">
              <h3 class="text-gray-400 text-xs font-bold uppercase mb-4 tracking-wider">
                ğŸ“š ê³¼ëª©ë³„ ë¶„í¬
              </h3>
              <div id="subject-distribution-list" class="space-y-3">
                <p class="text-gray-500">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script>
      const CONTINUE_API_URL =
        "http://localhost:18085/api/tracker/dashboard/continue";
      const COURSES_API_URL =
        "http://localhost:18085/api/tracker/dashboard/courses";
      const STATS_API_URL = "http://localhost:18085/api/tracker/dashboard/stats";

      // ì´ˆë¥¼ ì‹œê°„ í˜•ì‹(mm:ss)ìœ¼ë¡œ í¬ë§·í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
      function formatSecondsToTime(seconds) {
        if (seconds < 0) seconds = 0;
        const minutes = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${String(minutes).padStart(2, "0")}:${String(secs).padStart(
          2,
          "0"
        )}`;
      }

      // ì‹œê°„ ë¬¸ìì—´ ("mm:ss")ì„ ì´ˆë¡œ ë³€í™˜í•˜ëŠ” í—¬í¼ í•¨ìˆ˜
      function parseTime(timeString) {
        if (!timeString) return 0;
        const parts = timeString.split(":").map(Number);
        return parts[0] * 60 + (parts[1] || 0);
      }

      // =========================================================
      // 1. ì´ì–´ë³´ê¸° ì¹´ë“œ ë Œë”ë§ í•¨ìˆ˜
      // =========================================================
      async function fetchAndRenderDashboardData() {
        try {
          const response = await fetch(CONTINUE_API_URL);
          if (!response.ok)
            throw new Error(`HTTP error! status: ${response.status}`);
          const data = await response.json();

          if (!data || !data.videoId) {
            document.getElementById("continue-card").innerHTML =
              '<p class="text-center text-gray-500 p-10">ì•„ì§ ì‹œì²­ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œì—ì„œ í•™ìŠµì„ ì‹œì‘í•´ ë³´ì„¸ìš”! ğŸš€</p>';
            return;
          }

          document.getElementById("continue-link").href = data.continueWatchUrl;
          document.getElementById("thumbnail-img").src = data.thumbnailUrl;
          document.getElementById("video-duration").innerText =
            data.totalDurationFormatted;
          document.getElementById("channel-name").innerText = data.channel;
          document.getElementById("video-title").innerText = data.title;

          const percentage = data.percentage;
          document.getElementById("progress-percentage").innerText = percentage;
          document.getElementById(
            "progress-bar-fill"
          ).style.width = `${percentage}%`;

          const totalSeconds = parseTime(data.totalDurationFormatted);
          const currentSeconds = parseTime(data.lastProgressTimeFormatted);
          const remainingSeconds = totalSeconds - currentSeconds;
          document.getElementById("remaining-time").innerText =
            formatSecondsToTime(remainingSeconds);
        } catch (error) {
          console.error("ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          document.getElementById("continue-card").innerHTML =
            '<p class="text-center text-red-500 p-10">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ë°±ì—”ë“œ ì„œë²„(18085)ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•˜ì„¸ìš”. ğŸ”´</p>';
        }
      }

      // =========================================================
      // 2. ì½”ìŠ¤ ëª©ë¡ ë Œë”ë§ í•¨ìˆ˜
      // =========================================================
      function createCourseListItem(course) {
        const isCompleted = course.percentage >= 100;
        const progressColor = isCompleted ? "bg-green-500" : "bg-red-600";
        const progressText = isCompleted
          ? "ê°•ì˜ ì™„ë£Œ"
          : `${course.percentage}%`;
        const thumbnailUrl = `https://img.youtube.com/vi/${course.videoId}/mqdefault.jpg`;

        // data-videoid ì†ì„±ì„ ì¶”ê°€í•˜ì—¬ ì´ ë²„íŠ¼ì´ ì–´ë–¤ ë¹„ë””ì˜¤ë¥¼ ì‚­ì œí• ì§€ ì•Œê²Œ í•©ë‹ˆë‹¤.
        return `
                <div class="bg-[#1f1f1f] p-4 rounded-lg flex items-center gap-4 border border-[#272727] hover:bg-[#272727] transition group relative">
                    
                    <a href="${
                      course.continueWatchUrl
                    }" target="_blank" class="flex-1 flex items-center gap-4">
                        <div class="w-32 thumbnail-card bg-gray-800 rounded relative overflow-hidden flex-shrink-0">
                            <img src="${thumbnailUrl}" class="w-full h-full object-cover" alt="Thumbnail">
                            <div class="absolute bottom-0 w-full h-1 bg-gray-600">
                                <div class="h-full ${progressColor}" style="width: ${
          course.percentage
        }%"></div>
                            </div>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-white group-hover:text-red-500 transition line-clamp-2">${
                              course.title
                            }</h4>
                            <div class="flex items-center gap-2 text-xs text-gray-400 mt-1">
                                <span><i class="fas fa-list-ul mr-1"></i> ${
                                  course.channel
                                }</span>
                                <span>â€¢</span>
                                <span>ë§ˆì§€ë§‰ í•™ìŠµ: ${
                                  course.lastProgressTimeAgo
                                }</span>
                            </div>
                        </div>
                    </a>
                    
                    <div class="text-right flex items-center gap-4 flex-shrink-0">
                        <div class="text-xl font-bold ${
                          isCompleted ? "text-green-500" : "text-red-500"
                        }">${progressText}</div>
                        
                        <button 
                            class="delete-button text-gray-500 hover:text-red-600 transition p-2 rounded-full hover:bg-gray-700"
                            data-videoid="${course.videoId}"
                            data-title="${course.title}"
                            title="ê¸°ë¡ ì‚­ì œ">
                            <i class="fas fa-trash-alt text-lg"></i>
                        </button>
                    </div>
                </div>
            `;
      }

      async function fetchAndRenderCourses() {
        const container = document.getElementById("course-list-container");
        if (!container) return;

        try {
          const response = await fetch(COURSES_API_URL);
          if (!response.ok)
            throw new Error(`HTTP error! status: ${response.status}`);

          const courses = await response.json();

          if (courses.length === 0) {
            container.innerHTML =
              '<p class="text-gray-500 p-4">ì•„ì§ ì‹œì²­ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ìœ íŠœë¸Œ ì˜ìƒì„ ì‹œì²­í•˜ë©´ ì—¬ê¸°ì— ëª©ë¡ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>';
            return;
          }

          container.innerHTML = courses.map(createCourseListItem).join("");
        } catch (error) {
          console.error("ì½”ìŠ¤ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          container.innerHTML =
            '<p class="text-red-500 p-4">ì½”ìŠ¤ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨. ë°±ì—”ë“œ ì„œë²„ í™•ì¸. ğŸ”´</p>';
        }
      }

      // =========================================================
      // 3. í†µê³„ ë Œë”ë§ í•¨ìˆ˜
      // =========================================================
      function createSubjectListItem(stat) {
        // Tailwind CSSì—ì„œ ë™ì ìœ¼ë¡œ í´ë˜ìŠ¤ ì´ë¦„ì„ ìƒì„±í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, ë¬¸ìì—´ë¡œ ì²˜ë¦¬
        return `
                <div class="flex justify-between text-sm">
                    <span class="text-white"><i class="fas fa-circle text-${stat.color} text-[8px] mr-2"></i>${stat.subjectName}</span>
                    <span class="font-bold">${stat.percentage}%</span>
                </div>
            `;
      }

      async function fetchAndRenderStats(periodType = "all") {
        const url = `${STATS_API_URL}?periodType=${periodType}`;
        try {
          // ë¡œë”© ìƒíƒœ í‘œì‹œ (ì„ íƒì ìœ¼ë¡œ ì¶”ê°€)
          document.getElementById("total-study-time").innerText = "...";
          document.getElementById("subject-distribution-list").innerHTML =
            '<p class="text-gray-500">ë¡œë”© ì¤‘...</p>';

          const response = await fetch(url);
          if (!response.ok)
            throw new Error(`HTTP error! status: ${response.status}`);
          const stats = await response.json();

          // 1. Total Study Time ì—…ë°ì´íŠ¸
          document.getElementById("total-study-time").innerText =
            stats.totalStudyTimeFormatted;

          // 2. Weekly Goal ì—…ë°ì´íŠ¸
          const goalPercentage = Math.round(stats.weekGoalPercentage);
          document.getElementById("week-goal-percentage").innerText =
            goalPercentage;
          document.getElementById("week-goal-bar").style.width = `${Math.min(
            100,
            goalPercentage
          )}%`;

          // 3. Subject Distribution ì—…ë°ì´íŠ¸
          const listContainer = document.getElementById(
            "subject-distribution-list"
          );
          if (stats.subjectStats && stats.subjectStats.length > 0) {
            listContainer.innerHTML = stats.subjectStats
              .map(createSubjectListItem)
              .join("");
          } else {
            listContainer.innerHTML =
              '<p class="text-gray-500">ì¡°íšŒëœ í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
          }
        } catch (error) {
          console.error("í†µê³„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          document.getElementById("total-study-time").innerText = "Error";
          document.getElementById("subject-distribution-list").innerHTML =
            '<p class="text-red-500">í†µê³„ ë¡œë“œ ì‹¤íŒ¨. ğŸ”´</p>';
        }
      }

      // =========================================================
      // 4. ì‚¬ì´ë“œë°” íƒìƒ‰ ê¸°ëŠ¥ (ìŠ¤í¬ë¡¤)
      // =========================================================

      function setupSidebarNavigation() {
        const mainContent = document.querySelector("main > div:last-child"); // ìŠ¤í¬ë¡¤ì´ ë°œìƒí•˜ëŠ” ì»¨í…Œì´ë„ˆ

        // 1. ëŒ€ì‹œë³´ë“œ ë²„íŠ¼ (ì²« ë²ˆì§¸ ë²„íŠ¼)
        const dashboardButton = document.querySelector(
          "aside nav button:nth-child(1)"
        );
        dashboardButton.addEventListener("click", () => {
          // í˜ì´ì§€ ìƒë‹¨ìœ¼ë¡œ ì´ë™
          mainContent.scrollTo({ top: 0, behavior: "smooth" });
        });

        // 2. í†µê³„ ë²„íŠ¼ (ë‘ ë²ˆì§¸ ë²„íŠ¼)
        const statsButton = document.querySelector(
          "aside nav button:nth-child(2)"
        );
        statsButton.addEventListener("click", () => {
          // ìŠ¤í¬ë¡¤ ì´ë™
          document.getElementById("stats-section").scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        });

        // 3. ì¬ìƒëª©ë¡ ë²„íŠ¼ (ì„¸ ë²ˆì§¸ ë²„íŠ¼)
        const coursesButton = document.querySelector(
          "aside nav button:nth-child(3)"
        );
        coursesButton.addEventListener("click", () => {
          // ìŠ¤í¬ë¡¤ ì´ë™
          document.getElementById("courses-section").scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        });
      }

      function setupPeriodFiltering() {
        const periodButtons = document.querySelectorAll('.period-button');
        let activePeriod = 'all'; // ê¸°ë³¸ê°’

        periodButtons.forEach((button) => {
          button.addEventListener('click', () => {
            // ì´ì „ í™œì„± ë²„íŠ¼ì—ì„œ ìŠ¤íƒ€ì¼ ì œê±°
            periodButtons.forEach((btn) => {
              btn.classList.remove('bg-red-600', 'text-white', 'border-red-500');
              btn.classList.add('bg-[#272727]', 'text-gray-300');
            });

            // í˜„ì¬ í´ë¦­ëœ ë²„íŠ¼ì— í™œì„± ìŠ¤íƒ€ì¼ ì ìš©
            button.classList.remove('bg-[#272727]', 'text-gray-300');
            button.classList.add('bg-red-600', 'text-white', 'border-red-500');

            activePeriod = button.dataset.period;
            fetchAndRenderStats(activePeriod);
          });
        });

        // ì´ˆê¸° ë¡œë“œ ì‹œ "ì „ì²´ ëˆ„ì " ë²„íŠ¼ í™œì„±í™”
        const allButton = document.querySelector('[data-period="all"]');
        if (allButton) {
          allButton.classList.remove('bg-[#272727]', 'text-gray-300');
          allButton.classList.add('bg-red-600', 'text-white', 'border-red-500');
        }
      }

      // =========================================================
      // 5. ê¸°ë¡ ì‚­ì œ ê¸°ëŠ¥
      // =========================================================

      async function deleteVideo(videoId, videoTitle) {
        if (
          !confirm(`'${videoTitle}' ì˜ìƒì˜ ëª¨ë“  í•™ìŠµ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)
        ) {
          return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•¨
        }

        const DELETE_API_URL = `http://localhost:18085/api/tracker/video/${videoId}`;

        try {
          const response = await fetch(DELETE_API_URL, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
          });

          if (response.status === 204) {
            alert(`'${videoTitle}' ê¸°ë¡ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);

            // ì‚­ì œ í›„ ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ìƒˆë¡œê³ ì¹¨
            fetchAndRenderCourses();
            fetchAndRenderStats(
              document.getElementById("period-selector").value
            ); // í˜„ì¬ í•„í„° ê¸°ì¤€ìœ¼ë¡œ í†µê³„ ìƒˆë¡œê³ ì¹¨
            fetchAndRenderDashboardData(); // Continue Watchingë„ ìƒˆë¡œê³ ì¹¨
          } else {
            throw new Error(`ì‚­ì œ ì‹¤íŒ¨: HTTP Status ${response.status}`);
          }
        } catch (error) {
          console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          alert(
            `ê¸°ë¡ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”. (${error.message})`
          );
        }
      }

      function setupDeleteButtons() {
        const container = document.getElementById("course-list-container");

        // ì½”ìŠ¤ ëª©ë¡ ì»¨í…Œì´ë„ˆì— ì´ë²¤íŠ¸ ìœ„ì„ (ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë¶™ì´ê¸° ìœ„í•¨)
        container.addEventListener("click", (event) => {
          // í´ë¦­ëœ ìš”ì†Œ ë˜ëŠ” ê·¸ ë¶€ëª¨ ìš”ì†Œ ì¤‘ì—ì„œ 'delete-button' í´ë˜ìŠ¤ë¥¼ ì°¾ìŠµë‹ˆë‹¤.
          const button = event.target.closest(".delete-button");

          if (button) {
            const videoId = button.dataset.videoid;
            const videoTitle = button.dataset.title;
            if (videoId) {
              deleteVideo(videoId, videoTitle);
            }
          }
        });
      }

      // =========================================================
      // 6. í•™ìŠµ ìŠ¤íŠ¸ë¦­ ë°°ì§€ ì—…ë°ì´íŠ¸
      // =========================================================
      async function updateStreakBadge() {
        try {
          const response = await fetch('http://localhost:18085/api/tracker/streak');
          if (!response.ok) throw new Error('Streak fetch failed');
          
          const streak = await response.json();
          const currentStreak = streak.currentStreak || 0;
          const badge = document.getElementById('streak-badge');
          
          if (currentStreak > 0) {
            badge.textContent = currentStreak === 1 ? '1 Day' : `${currentStreak} Days`;
          } else {
            badge.textContent = '0 Day';
          }

          // ì•Œë¦¼ í‘œì‹œ
          if (streak.shouldNotify && streak.notificationMessage) {
            showStreakNotificationBrowser(streak.notificationMessage, streak.notificationType);
          }
        } catch (error) {
          console.error('Failed to fetch streak:', error);
        }
      }

      // =========================================================
      // ìŠ¤íŠ¸ë¦­ ì•Œë¦¼ (Browser Notification API)
      // =========================================================
      function showStreakNotificationBrowser(message, type) {
        if ('Notification' in window && Notification.permission === 'granted') {
          const options = {
            icon: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/svgs/solid/fire.svg',
            badge: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/svgs/solid/star.svg',
            tag: 'streak-notification',
            requireInteraction: false,
          };

          if (type === 'milestone') {
            options.icon = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/svgs/solid/trophy.svg';
          } else if (type === 'encouragement') {
            options.icon = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/svgs/solid/heart.svg';
          }

          new Notification('ğŸ‰ TubeStudy', options).then((notification) => {
            setTimeout(() => notification.close(), 5000);
          });
        } else if ('Notification' in window && Notification.permission !== 'denied') {
          Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
              new Notification('ğŸ‰ TubeStudy', { body: message }).then((n) => {
                setTimeout(() => n.close(), 5000);
              });
            }
          });
        }
      }

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  í•¨ìˆ˜ ì‹¤í–‰
      fetchAndRenderDashboardData();
      fetchAndRenderCourses();
      fetchAndRenderStats(); // ì´ˆê¸° ë¡œë“œ ì‹œ 'all' (ê¸°ë³¸ê°’)ìœ¼ë¡œ í˜¸ì¶œ
      setupSidebarNavigation();
      setupPeriodFiltering(); // ê¸°ê°„ í•„í„°ë§ ì„¤ì • í•¨ìˆ˜ í˜¸ì¶œ
      setupDeleteButtons(); // ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸ ì„¤ì • í•¨ìˆ˜ í˜¸ì¶œ ì¶”ê°€
      updateStreakBadge(); // ìŠ¤íŠ¸ë¦­ ë°°ì§€ ì—…ë°ì´íŠ¸

      // 30ì´ˆë§ˆë‹¤ ìŠ¤íŠ¸ë¦­ ë°°ì§€ ì—…ë°ì´íŠ¸ (ìë™ ë™ê¸°í™”)
      setInterval(updateStreakBadge, 30000);
    </script>
  </body>
</html>
